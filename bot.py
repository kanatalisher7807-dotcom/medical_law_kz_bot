import os
import json
import logging
from typing import Optional, Dict, Any, List

from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

logging.basicConfig(level=logging.INFO)

TOKEN = os.getenv("TELEGRAM_TOKEN")
FAQ_PATH = os.getenv("FAQ_PATH", "faq.json")

DISCLAIMER = (
    "‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –∑–∞–∫–ª—é—á–µ–Ω–∏–µ–º. "
    "–î–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´‚úâÔ∏è –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é¬ª."
)

SECTIONS = [SECTION_TO_QUERY = {
    "‚öñÔ∏è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—à–∏–±–∫–∏": "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –æ—à–∏–±–∫–∞",
    "üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã": "–∏–Ω—Ü–∏–¥–µ–Ω—Ç",
    "üè• –ñ–∞–ª–æ–±—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞": "–∂–∞–ª–æ–±–∞",
    "‚úçÔ∏è –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ": "–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ",
    "üîí –í—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞": "–≤—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞",
    "üëÆ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤": "–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤",
}

    "‚öñÔ∏è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—à–∏–±–∫–∏",
    "üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã",
    "üè• –ñ–∞–ª–æ–±—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞",
    "‚úçÔ∏è –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ",
    "üîí –í—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞",
    "üëÆ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤",
    "üìÑ –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞",
    "‚úâÔ∏è –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é",
    "üß™ –ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã",
]

menu = ReplyKeyboardMarkup(resize_keyboard=True)
menu.add(KeyboardButton(SECTIONS[0]), KeyboardButton(SECTIONS[1]))
menu.add(KeyboardButton(SECTIONS[2]), KeyboardButton(SECTIONS[3]))
menu.add(KeyboardButton(SECTIONS[4]), KeyboardButton(SECTIONS[5]))
menu.add(KeyboardButton(SECTIONS[6]))
menu.add(KeyboardButton(SECTIONS[7]), KeyboardButton(SECTIONS[8]))

def load_faq() -> List[Dict[str, Any]]:
    try:
        with open(FAQ_PATH, "r", encoding="utf-8") as f:
            data = json.load(f)
        if not isinstance(data, list):
            return []
        return data
    except Exception as e:
        logging.exception("Failed to load FAQ: %s", e)
        return []

FAQ = load_faq()

def find_answer(user_text: str) -> Optional[Dict[str, Any]]:
    text = (user_text or "").lower()
    best = None
    best_score = 0

    for entry in FAQ:
        keywords = entry.get("keywords") or []
        score = 0
        for kw in keywords:
            if isinstance(kw, str) and kw.lower() in text:
                score += 1
        if score > best_score:
            best_score = score
            best = entry

    return best if best_score > 0 else None

if not TOKEN:
    raise RuntimeError("TELEGRAM_TOKEN is not set.")

bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

@dp.message_handler(commands=["start"])
async def start(message: types.Message):
    text = (
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –±–æ—Ç –∫–∞—Ñ–µ–¥—Ä—ã –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞.\n\n"
        "–Ø –ø–æ–º–æ–≥–∞—é —Å —Ç–∏–ø–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏: –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã, –∂–∞–ª–æ–±—ã, "
        "–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ, –≤—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º."
    )
    await message.answer(text, reply_markup=menu)

@dp.message_handler(commands=["help", "menu"])
async def help_cmd(message: types.Message):
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∫–Ω–æ–ø–∫–∞–º–∏ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º.", reply_markup=menu)

@dp.message_handler(lambda m: m.text == "üìÑ –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞")
async def law_base(message: types.Message):
    text = (
        "üìÑ –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã):\n"
        "‚Ä¢ –ö–æ–¥–µ–∫—Å –†–ö ¬´–û –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞—Ä–æ–¥–∞ –∏ —Å–∏—Å—Ç–µ–º–µ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è¬ª\n"
        "‚Ä¢ –£–ö / –ö–æ–ê–ü / –ì–ö / –¢–ö –†–ö ‚Äî –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏\n"
        "‚Ä¢ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã –º–µ–¥–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∏–∫–∞–∑—ã —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω–∞\n\n"
        "–ï—Å–ª–∏ –Ω–∞–ø–∏—à–µ—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–≤—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞¬ª), —è –ø–æ–¥—Å–∫–∞–∂—É —Ç–∏–ø–æ–≤–æ–π –±–ª–æ–∫ –Ω–æ—Ä–º."
    )
    await message.answer(text, reply_markup=menu)

@dp.message_handler(lambda m: m.text == "‚úâÔ∏è –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é")
async def ask_teacher(message: types.Message):
    await message.answer(
        "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.\n"
        "–§–æ—Ä–º–∞—Ç: *–¢–µ–º–∞* ‚Üí *–°—É—Ç—å –≤–æ–ø—Ä–æ—Å–∞*.\n"
        "–ù–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ª–∏—à–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.",
        parse_mode="Markdown",
        reply_markup=menu,
    )

@dp.message_handler(lambda m: m.text == "üß™ –ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã")
async def mini_tests(message: types.Message):
    await message.answer(
        "–ú–∏–Ω–∏‚Äë—Ç–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.\n"
        "–ü–æ–∫–∞ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º ‚Äî —è –æ—Ç–≤–µ—á—É –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.",
        reply_markup=menu,
    )
@dp.message_handler(lambda m: m.text == "‚öñÔ∏è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—à–∏–±–∫–∏")
async def btn_med_errors(message: types.Message):
    text = (
        "‚öñÔ∏è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—à–∏–±–∫–∏ ‚Äî —Ä–∞–∑–¥–µ–ª –ø—Ä–æ —Ç–∏–ø–æ–≤—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏:\n"
        "‚Ä¢ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –æ—à–∏–±–∫—É/–¥–µ—Ñ–µ–∫—Ç –æ–∫–∞–∑–∞–Ω–∏—è –ø–æ–º–æ—â–∏\n"
        "‚Ä¢ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ\n"
        "‚Ä¢ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (–∫–∞–∫ –æ—Ç–ª–∏—á–∞—Ç—å –æ—Ç –æ—à–∏–±–∫–∏)\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ 1‚Äì2 —Å–ª–æ–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑¬ª, ¬´–æ—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è¬ª) "
        "–∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –∫–æ—Ä–æ—Ç–∫–æ ‚Äî —è –ø–æ–¥—Å–∫–∞–∂—É —Ç–∏–ø–æ–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è."
    )
    await message.answer(text, reply_markup=menu)


@dp.message_handler(lambda m: m.text == "üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã")
async def btn_incidents(message: types.Message):
    text = (
        "üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã ‚Äî —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ/–Ω–µ—à—Ç–∞—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –º–µ–¥–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:\n"
        "‚Ä¢ –æ—Ç–∫–∞–∑ –≤ –ø—Ä–∏—ë–º–µ/–≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏\n"
        "‚Ä¢ –≥—Ä—É–±–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –æ–∫–∞–∑–∞–Ω–∏—è –ø–æ–º–æ—â–∏\n"
        "‚Ä¢ —Å–ø–æ—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è/–±–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å (2‚Äì3 —Ñ—Ä–∞–∑—ã): –≥–¥–µ, –∫–æ–≥–¥–∞, –∫—Ç–æ, –≤ —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî "
        "—è –ø–æ–¥—Å–∫–∞–∂—É, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç –∏ –∫—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è."
    )
    await message.answer(text, reply_markup=menu)


@dp.message_handler(lambda m: m.text == "üè• –ñ–∞–ª–æ–±—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞")
async def btn_patient_complaints(message: types.Message):
    text = (
        "üè• –ñ–∞–ª–æ–±—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞ ‚Äî –∫—É–¥–∞ –∏ –∫–∞–∫ –æ–±—Ä–∞—â–∞—Ç—å—Å—è (–ø–æ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–π):\n"
        "1) —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –º–µ–¥–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞–≤–µ–¥—É—é—â–∏–π/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä/–≥–ª–∞–≤–≤—Ä–∞—á) ‚Äî –ª—É—á—à–µ –ø–∏—Å—å–º–µ–Ω–Ω–æ\n"
        "2) —Å–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å (–µ—Å–ª–∏ –µ—Å—Ç—å)\n"
        "3) —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º\n"
        "4) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Å—É–¥/–ø—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ: ¬´–∂–∞–ª–æ–±–∞ –Ω–∞ –≤—Ä–∞—á–∞¬ª –∏–ª–∏ ¬´–∫—É–¥–∞ –∂–∞–ª–æ–≤–∞—Ç—å—Å—è¬ª ‚Äî –∏ —É—Ç–æ—á–Ω–∏—Ç–µ: –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞/—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä, –≥–æ—Å/—á–∞—Å—Ç–Ω–∞—è."
    )
    await message.answer(text, reply_markup=menu)


@dp.message_handler(lambda m: m.text == "‚úçÔ∏è –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ")
async def btn_informed_consent(message: types.Message):
    text = (
        "‚úçÔ∏è –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ ‚Äî –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º:\n"
        "‚Ä¢ —á—Ç–æ –æ–±—è–∑–∞–Ω—ã –æ–±—ä—è—Å–Ω–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç—É (—Ü–µ–ª—å, —Ä–∏—Å–∫–∏, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ—Ç–∫–∞–∑–∞)\n"
        "‚Ä¢ –º–æ–∂–Ω–æ –ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –∏ –∫–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã\n"
        "‚Ä¢ –∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –æ—Ç–∫–∞–∑ (–∫–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ)\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ: ¬´—Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é¬ª, ¬´–Ω–µ –¥–∞—é—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–π¬ª, ¬´—Ö–æ—á—É –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è¬ª ‚Äî —è –¥–∞–º —Ç–∏–ø–æ–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º."
    )
    await message.answer(text, reply_markup=menu)


@dp.message_handler(lambda m: m.text == "üîí –í—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞")
async def btn_med_secret(message: types.Message):
    text = (
        "üîí –í—Ä–∞—á–µ–±–Ω–∞—è —Ç–∞–π–Ω–∞ ‚Äî –ø—Ä–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –º–µ–¥–¥–∞–Ω–Ω—ã—Ö:\n"
        "‚Ä¢ —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç–∞–π–Ω–µ (–¥–∏–∞–≥–Ω–æ–∑, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ñ–∞–∫—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∏ –¥—Ä.)\n"
        "‚Ä¢ –∫–æ–º—É –∏ –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n"
        "‚Ä¢ —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ —Ä–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ: ¬´—Ä–∞–∑–≥–ª–∞—Å–∏–ª–∏ –¥–∏–∞–≥–Ω–æ–∑¬ª, ¬´–¥–∞–ª–∏ —Å–ø—Ä–∞–≤–∫—É –±–µ–∑ –º–µ–Ω—è¬ª, ¬´—Å–æ–æ–±—â–∏–ª–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º¬ª ‚Äî "
        "—è –ø–æ–¥—Å–∫–∞–∂—É —Ç–∏–ø–æ–≤–æ–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π."
    )
    await message.answer(text, reply_markup=menu)


@dp.message_handler(lambda m: m.text == "üëÆ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤")
async def btn_responsibility(message: types.Message):
    text = (
        "üëÆ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ ‚Äî –æ–±—â–∏–π –æ–±–∑–æ—Ä:\n"
        "‚Ä¢ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω–∞—è (–≤–Ω—É—Ç—Ä–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)\n"
        "‚Ä¢ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ-–ø—Ä–∞–≤–æ–≤–∞—è (–≤–æ–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–¥–∞)\n"
        "‚Ä¢ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è (–ö–æ–ê–ü) –∏ —É–≥–æ–ª–æ–≤–Ω–∞—è (–£–ö) ‚Äî –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–æ—Å—Ç–∞–≤–∞\n\n"
        "–ß—Ç–æ–±—ã —É—Ç–æ—á–Ω–∏—Ç—å, –Ω–∞–ø–∏—à–∏—Ç–µ: –±—ã–ª –ª–∏ –≤—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤—å—é, –µ—Å—Ç—å –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–≤—ã–ø–∏—Å–∫–∞/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è), "
        "–∏ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ: ¬´–∂–∞–ª–æ–±–∞¬ª, ¬´–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è¬ª, ¬´–æ—Ü–µ–Ω–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤—Ä–∞—á–∞¬ª."
    )
    await message.answer(text, reply_markup=menu)
@dp.message_handler(lambda m: m.text in SECTION_TO_QUERY)
async def handle_section_buttons(message: types.Message):
    query = SECTION_TO_QUERY.get(message.text)
    entry = find_answer(query)

    if entry:
        answer = (entry.get("answer") or entry.get("a") or "").strip()
        if answer:
            await message.answer(answer, reply_markup=menu)
            return

    await message.answer(
        "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª—É –≥–æ—Ç–æ–≤–∏—Ç—Å—è. "
        "–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º.",
        reply_markup=menu
    )

        )

@dp.message_handler()
async def handle_text(message: types.Message):
    user_text = (message.text or "").strip()

    entry = find_answer(user_text)
    if entry:
        answer = (entry.get("answer") or entry.get("a") or "").strip()
        law = entry.get("law")
        if law:
            answer += f"\n\nüîπ –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞: {law}"
        answer += f"\n\n{DISCLAIMER}"
        await message.answer(answer, reply_markup=menu)
    else:
        await message.answer(
            "–ù–µ –Ω–∞—à—ë–ª —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–æ—â–µ (1‚Äì2 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞) "
            "–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´‚úâÔ∏è –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é¬ª.",
            reply_markup=menu,
        )

if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
